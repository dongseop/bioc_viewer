<div class="main-area"></div>

<div class="ui dimmer active" id="documentSpinner">
  <div class="ui text loader">Loading</div>
</div>
<%= render partial: "buttons" %>
<div class="ui message teal document">
  <%=render partial: "infon", locals: {infons: @document.bioc_doc.infons} %>
  <div class="header">Document - <%=@document.doc_id %></div>
  <div>
    Uploaded by <b><%=@document.user.name%></b> <%=time_ago_in_words @document.created_at %> ago<br>
    <ul class="list">
      <li>Source: <%=@document.bioc.source %></li>
      <li>Date: <%=@document.bioc.date %></li>
      <li>Key: <%=@document.bioc.key %></li>
    </ul>
  </div>
</div>

<% @document.bioc_doc.passages.each_with_index do |p, index| %>
  <div class="ui segment passage" data-id="<%=index%>" >
    <div class="ui top right attached label small">offset: <%=p.offset%> - <%=p.offset + p.text.size if !p.text.nil?%></div>
    <div class="ui top left teal attached label small"><%=p.infons["type"]%></div>
    <%case p.infons["type"] %>
    <% when "ref" %>
      <%=render partial: "ref", locals: {infons: p.infons, title: p.text} %>
    <% when "front" %>
      <% if !p.text.blank? %>
        <h1 class="<%=p.infons["type"]%>"><%=render partial: "text_fragment", locals: {p: p, ptext: p.text}%></h1>
      <% end %>
      <div class="ui message">
        <%=render partial: "ref", locals: {infons: p.infons, title: nil} %>
      </div>
    <% else %>
        <% if !p.text.blank? %>
          <div class="text <%=p.infons["type"]%>"><%=render partial: "text_fragment", locals: {p: p, ptext: p.text}%></div>
        <% end %>
    <% end %>
    <%=render partial: "infon", locals: {infons: p.infons} %>
    <%=render partial: "annotations", locals: {annotations: p.annotations} %>
  </div>
<% end %>
<%= render partial: "buttons" %>

<script>
var doc = new BioC('<%=@document.id%>');
doc.load()
.then(function() {
  $("#documentSpinner").removeClass("active");
});
$("span.annotation").popup({
    inline   : true,
    hoverable: true,
    position : 'bottom left',
    delay: {
      show: 100,
      hide: 500
    }
  });
</script>