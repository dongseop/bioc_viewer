<%= render partial: "buttons" %>
<div class="ui dimmer active" id="documentSpinner">
  <div class="ui text loader">Loading</div>
</div>
<%= render partial: "doc_info" %>
<div class="document clearfix">
  <div class="left-side pane">
    Outline
    <%= render partial: "outline", locals: {nodes: @document.outline} %>
  </div>
  <div class="main pane" id="main-document">
    <% @document.bioc_doc.passages.each_with_index do |p, index| %>
      <div class="ui basic segment passage" data-id="<%=index%>" id="passage-<%=index%>" >
        <div class="ui top right attached label mini passage-sub-info">
          offset: <%=p.offset%> - <%=p.offset + p.text.size if !p.text.nil?%>
        </div>
        <%=render partial: "infon", locals: {infons: p.infons, cls_name: "infon-#{index}"} %>
        <a href="#" class="infon-btn ui top left attached label mini passage-sub-info" data-id="<%=index%>">
          <%=p.infons["type"]%> <div class="detail">
          <i class="icon info circle"></i><%=p.infons.size%></div>
        </a>
        <% case p.infons["type"] %>
        <% when "ref" %>
          <%=render partial: "ref", locals: {infons: p.infons, title: p.text} %>
        <% when "front" %>
          <% if !p.text.blank? %>
            <h1 class="<%=p.infons["type"]%>"><%=render partial: "text_fragment", locals: {p: p, ptext: p.text}%></h1>
          <% end %>
          <div class="ui message">
            <%=render partial: "ref", locals: {infons: p.infons, title: nil} %>
          </div>
        <% else %>
            <% if !p.text.blank? %>
              <div class="text <%=p.infons["type"]%>"><%=render partial: "text_fragment", locals: {p: p, ptext: p.text}%></div>
            <% end %>
        <% end %>
      </div>
    <% end %>
  </div>
  <div class="ui right top right-side pane">
    <%= render partial: "ppi_form" %>
    <div class="ppis">
      <ul class="ppi-list ui bulleted list">
        <% @document.ppis.each do |p| %>
        <% end %>
      </ul>
    </div>
  </div>
</div>
<script id="ppi-template" type="text/x-handlebars-template">
  <li class="item" data-id="{{id}}">
    <a href='http://www.ncbi.nlm.nih.gov/gene?term={{gene1}}' target='_blank'><i class='icon globe'></i>{{gene1}}</a>
    -
    <a href='http://www.ncbi.nlm.nih.gov/gene?term={{gene2}}' target='_blank'><i class='icon globe'></i>{{gene2}}</a>
    <a class="delete-button" rel="nofollow" href="#">
      <i class="delete icon"></i>
    </a>
  </li>
</script>

<script>
var doc = new BioC('<%=@document.id%>');
doc.load()
.then(function() {
  $("#documentSpinner").removeClass("active");
});

</script>