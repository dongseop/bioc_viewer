<%= render partial: "buttons" %>
<div class="ui dimmer active" id="documentSpinner">
  <div class="ui text loader">Loading</div>
</div>
<%= render partial: "doc_info" %>
<div class="document clearfix">
  <div class="left-side pane">
    <h4>Outline</h4>
    <%= render partial: "outline", locals: {nodes: @document.outline} %>
  </div>
  <div class="main pane" id="main-document">
    <% @document.bioc_doc.passages.each_with_index do |p, index| %>
      <div class="ui basic segment passage" data-id="<%=index%>" id="passage-<%=index%>" >
        <div class="ui top right attached label mini passage-sub-info">
          offset: <%=p.offset%> - <%=p.offset + p.text.size if !p.text.nil?%>
        </div>
        <%=render partial: "infon", locals: {infons: p.infons, cls_name: "infon-#{index}"} %>
        <a href="#" class="infon-btn ui top left attached label mini passage-sub-info" data-id="<%=index%>">
          <%=p.infons["type"]%> <div class="detail">
          <i class="icon info circle"></i><%=p.infons.size%></div>
        </a>
        <% case p.infons["type"] %>
        <% when "ref" %>
          <%=render partial: "ref", locals: {infons: p.infons, title: p.text} %>
        <% when "front" %>
          <% if !p.text.blank? %>
            <h1 class="<%=p.infons["type"]%>"><%=render partial: "text_fragment", locals: {p: p, ptext: p.text}%></h1>
          <% end %>
          <div class="ui message">
            <%=render partial: "ref", locals: {infons: p.infons, title: nil} %>
          </div>
        <% else %>
            <% if !p.text.blank? %>
              <div class="text <%=p.infons["type"]%>"><%=render partial: "text_fragment", locals: {p: p, ptext: p.text}%></div>
            <% end %>
        <% end %>
      </div>
    <% end %>
  </div>
  <div class="ui right top right-side pane">
    <%= render partial: "ppi_form" %>
    <div class="ppis">
      <h4>
        PPI/GI Annotation List 
        <span class="ui label circular olive ppi-cnt tiny"></span>
        <%=link_to "/documents/#{@document.id}/ppis.csv", class: "export-btn ui teal circular icon button small", title: "Export CSV", target: "_blank" do %>
          <i class="icon download"></i>
        <% end %>
      </h4>
      <table class="ui small table celled blue very compact">
        <thead>
          <th></th>
          <th>Gene 1</th>
          <th>Gene 2</th>
          <th></th>
        </thead>
        <tbody class="ppi-list">
        </tbody>
      </table>
    </div>
  </div>
</div>
<%=render partial: "ppi_type_modal" %>
<%=render partial: "ppi_exp_modal" %>

<%=render partial: "delete_confirm_modal" %>
<script id="ppi-template" type="text/x-handlebars-template">
  <tr data-id="{{id}}" class="{{itype}} item">
    <td class="type type-toggle" rowspan="2">
      <div class="ppi">PPI</div>
      <div class="gi">GI</div>
    </div>
    <td class='gene'>
      <a href='http://www.ncbi.nlm.nih.gov/gene?term={{gene1}}' target='_blank'><i class='icon globe'></i>{{gene1}}</a>
      <br>
      <span class='popup' title='{{name1}}'>{{name1}}</span>
    </td>
    <td class='gene'>
      <a href='http://www.ncbi.nlm.nih.gov/gene?term={{gene2}}' target='_blank'><i class='icon globe'></i>{{gene2}}</a>
      <br>
      <span class='popup' title='{{name2}}'>{{name2}}</span>
    </td>
    <td class='action' rowspan="2">
      <a class="delete-button" rel="nofollow" href="#" title="Delete">
        <i class="delete icon"></i>
      </a>
    </td>
  </tr>
  <tr data-id="{{id}}" class="item">
    <td colspan="2" class="exp-name">
      <span>{{exp}}</span>
      <a class="edit-button" rel="nofollow" href="#" title="Edit">
        <i class="write icon"></i>
      </a>
    </td>
  </tr>
</script>

<script>
var doc = new BioC('<%=@document.id%>');
// doc.load()
// .then(function() {
//   $("#documentSpinner").removeClass("active");
// });
  $("#documentSpinner").removeClass("active");



</script>